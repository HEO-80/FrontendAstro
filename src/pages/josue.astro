---
import Layout from "../layouts/Layout.astro";
---

<Layout>
  <div class="bauhaus-bg">
    <h1 class="text-3xl font-bold text-center mt-10">Josué Daniel</h1>
    <p class="text-center mt-4">Minijuego</p>

    <div class="max-w-2xl mx-auto mt-6 p-8">
      <div class="game-container">
        <h2 class="game-title">3 en Raya</h2>
        <div class="info">Turno: <span class="current-player">X</span></div>
        <div class="board" id="board">
          <div class="cell" data-index="0"></div>
          <div class="cell" data-index="1"></div>
          <div class="cell" data-index="2"></div>
          <div class="cell" data-index="3"></div>
          <div class="cell" data-index="4"></div>
          <div class="cell" data-index="5"></div>
          <div class="cell" data-index="6"></div>
          <div class="cell" data-index="7"></div>
          <div class="cell" data-index="8"></div>
        </div>
        <button class="reset-btn" id="resetBtn">Nuevo Juego</button>
      </div>

      <!-- Decoración Bauhaus -->
      <div class="decoration circle1"></div>
      <div class="decoration square1"></div>
      <div class="decoration triangle1"></div>
    </div>
  </div>
</Layout>

<style>
  .bauhaus-bg {
    min-height: 100vh;
    background: linear-gradient(135deg, #b8e6d5 0%, #a8dcc5 100%);
    position: relative;
    overflow: hidden;
  }

  /* Decoración Bauhaus de fondo */
  .bauhaus-bg::before {
    content: "";
    position: absolute;
    width: 300px;
    height: 300px;
    background: #ffb6c1;
    border-radius: 50%;
    top: -100px;
    left: -100px;
    opacity: 0.3;
    z-index: 0;
  }

  .bauhaus-bg::after {
    content: "";
    position: absolute;
    width: 200px;
    height: 200px;
    background: #ffd700;
    bottom: -50px;
    right: -50px;
    opacity: 0.3;
    z-index: 0;
  }

  .game-container {
    text-align: center;
    position: relative;
    z-index: 1;
  }

  .game-title {
    font-family: "Arial Black", "Arial Bold", sans-serif;
    font-size: 3.5em;
    color: #2c3e50;
    margin-bottom: 15px;
    text-transform: uppercase;
    letter-spacing: 8px;
    text-shadow: 4px 4px 0px #ffb6c1;
    font-weight: 900;
  }

  .info {
    font-family: "Arial Black", "Arial Bold", sans-serif;
    font-size: 1.5em;
    color: #2c3e50;
    margin-bottom: 30px;
    font-weight: bold;
    text-transform: uppercase;
    letter-spacing: 3px;
  }

  .current-player {
    color: #ffb6c1;
    text-shadow: 2px 2px 0px #2c3e50;
  }

  .board {
    display: grid;
    grid-template-columns: repeat(3, 140px);
    grid-template-rows: repeat(3, 140px);
    gap: 15px;
    background: #2c3e50;
    padding: 15px;
    border-radius: 10px;
    box-shadow: 10px 10px 0px rgba(255, 182, 193, 0.5);
    width: fit-content;
    margin: 0 auto 30px;
  }

  .cell {
    background: #f5f5f5;
    border: none;
    cursor: pointer;
    font-size: 4em;
    font-weight: bold;
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
  }

  .cell:hover:not(.taken) {
    background: #ffb6c1;
    transform: scale(1.05);
  }

  .cell.taken {
    cursor: not-allowed;
  }

  /* X styling - Bauhaus inspired */
  .cell.x::before,
  .cell.x::after {
    content: "";
    position: absolute;
    width: 80%;
    height: 12px;
    background: #4169e1;
    top: 50%;
    left: 50%;
    transform-origin: center;
  }

  .cell.x::before {
    transform: translate(-50%, -50%) rotate(45deg);
    animation: drawX1 0.3s ease forwards;
  }

  .cell.x::after {
    transform: translate(-50%, -50%) rotate(-45deg);
    animation: drawX2 0.3s ease 0.15s forwards;
    opacity: 0;
  }

  /* O styling - Bauhaus circle */
  .cell.o::before {
    content: "";
    position: absolute;
    width: 75%;
    height: 75%;
    border: 12px solid #e74c3c;
    border-radius: 50%;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%) scale(0);
    animation: drawO 0.3s ease forwards;
  }

  @keyframes drawX1 {
    from {
      width: 0;
    }
    to {
      width: 80%;
    }
  }

  @keyframes drawX2 {
    from {
      width: 0;
      opacity: 0;
    }
    to {
      width: 80%;
      opacity: 1;
    }
  }

  @keyframes drawO {
    to {
      transform: translate(-50%, -50%) scale(1);
    }
  }

  .cell.winner {
    background: #ffd700 !important;
    animation: pulse 0.6s ease infinite;
  }

  @keyframes pulse {
    0%,
    100% {
      transform: scale(1);
    }
    50% {
      transform: scale(1.1);
    }
  }

  .reset-btn {
    background: #ffb6c1;
    color: #2c3e50;
    border: 5px solid #2c3e50;
    padding: 15px 40px;
    font-size: 1.3em;
    font-weight: bold;
    text-transform: uppercase;
    letter-spacing: 3px;
    cursor: pointer;
    transition: all 0.3s ease;
    box-shadow: 6px 6px 0px #2c3e50;
    font-family: "Arial Black", "Arial Bold", sans-serif;
  }

  .reset-btn:hover {
    background: #ff99ad;
    transform: translate(3px, 3px);
    box-shadow: 3px 3px 0px #2c3e50;
  }

  .reset-btn:active {
    transform: translate(6px, 6px);
    box-shadow: 0px 0px 0px #2c3e50;
  }

  /* Decoración geométrica */
  .decoration {
    position: absolute;
    z-index: 0;
  }

  .circle1 {
    width: 80px;
    height: 80px;
    background: #4169e1;
    border-radius: 50%;
    top: 20%;
    right: 10%;
    opacity: 0.6;
  }

  .square1 {
    width: 60px;
    height: 60px;
    background: #ffd700;
    bottom: 20%;
    left: 8%;
    opacity: 0.6;
    transform: rotate(15deg);
  }

  .triangle1 {
    width: 0;
    height: 0;
    border-left: 40px solid transparent;
    border-right: 40px solid transparent;
    border-bottom: 70px solid #e74c3c;
    top: 60%;
    right: 5%;
    opacity: 0.6;
  }
</style>

<script>
  let currentPlayer = "X";
  let gameBoard = ["", "", "", "", "", "", "", "", ""];
  let gameActive = true;

  const winConditions = [
    [0, 1, 2],
    [3, 4, 5],
    [6, 7, 8], // Horizontales
    [0, 3, 6],
    [1, 4, 7],
    [2, 5, 8], // Verticales
    [0, 4, 8],
    [2, 4, 6], // Diagonales
  ];

  const cells = document.querySelectorAll(".cell");
  const currentPlayerDisplay = document.querySelector(".current-player");
  const resetBtn = document.getElementById("resetBtn");

  cells.forEach((cell) => {
    cell.addEventListener("click", handleCellClick);
  });

  resetBtn?.addEventListener("click", resetGame);

  function handleCellClick(e: Event) {
    const cell = e.target as HTMLElement;
    const index = cell.getAttribute("data-index");

    if (!index || gameBoard[parseInt(index)] !== "" || !gameActive) {
      return;
    }

    const idx = parseInt(index);
    gameBoard[idx] = currentPlayer;
    cell.classList.add(currentPlayer.toLowerCase());
    cell.classList.add("taken");

    if (checkWin()) {
      gameActive = false;
      highlightWinner();
      setTimeout(() => {
        alert(`¡${currentPlayer} ha ganado!`);
      }, 500);
      return;
    }

    if (checkDraw()) {
      gameActive = false;
      setTimeout(() => {
        alert("¡Empate!");
      }, 500);
      return;
    }

    currentPlayer = currentPlayer === "X" ? "O" : "X";
    if (currentPlayerDisplay) {
      currentPlayerDisplay.textContent = currentPlayer;
    }
  }

  function checkWin() {
    return winConditions.some((condition) => {
      return condition.every((index) => {
        return gameBoard[index] === currentPlayer;
      });
    });
  }

  function checkDraw() {
    return gameBoard.every((cell) => cell !== "");
  }

  function highlightWinner() {
    winConditions.forEach((condition) => {
      if (condition.every((index) => gameBoard[index] === currentPlayer)) {
        condition.forEach((index) => {
          cells[index].classList.add("winner");
        });
      }
    });
  }

  function resetGame() {
    gameBoard = ["", "", "", "", "", "", "", "", ""];
    gameActive = true;
    currentPlayer = "X";
    if (currentPlayerDisplay) {
      currentPlayerDisplay.textContent = currentPlayer;
    }

    cells.forEach((cell) => {
      cell.className = "cell";
    });
  }
</script>
